## `csapp`

### 第三章

#### 一. 汇编指令

1. `rip`是和`text段`有关的寄存器。
2. `rsp`是和`stack`有关的寄存器。
3. `rbp ===> rsp`之间的是和当前被调函数有关的内存。

#### 二. 知识点

1. 一些关于机器代码和它的反汇编表示的特性值得注意:

   - ```assembly
     1 0000000000000000 <multstore> :
     	Offset Bytes				Equlvalent assemblu language
     2 		0:  53					push  %rbx
     3 		1:  48 89 d3			mov   %rdx,%rbx
     4 		4:  e8 00 00 00 00		callq 9 <multstore+Ox9>
     5 		9:  48 89 03			mov   %rax,(%rbx)
     6 		c:  5b					pop   %rbx
     7 		d:  c3					retq
     ```

     

   - `x86-64`的指令长度从1到15个字节不等。常用的指令以及操作数较少的指令所需的字节数少,而那些不太常用或操作数较多的指令所需字节数较多。
   - 设计指令格式的方式是,从某个给定位置开始,可以将字节唯一地解码成机器指令。例如,只有指令`pushq %rbx`是以字节值53开头的。
   - 反汇编器只是基于机器代码文件中的字节序列来确定汇编代码。它不需要访间该程序的源代码或汇编代码。
   - 反汇编器使用的指令命名规则与`GCC`生成的汇编代码使用的有些细微的差别。在我们的示例中,它省略了很多指令结尾的`'q'`。这些后缀是大小指示符,在大多数情况中可以省略。相反,反汇编器给`call`和`ret`指令添加了`'q'`,后缀,同样,省略这些后缀也没有问题。

2. 当指令以寄存器作为目标时，对于生成小于8字节结果的指令,寄存器中剩下的字节会怎么样呢？

   - 对此有两条规则:
     - 生成1字节和2字节数字的指令会保持剩下的字节不变;
     - 生成4字节数字的指令会把高位4个字节置为0。
     - 后面这条规则是作为从`IA32`到`x86-64`的扩展的一部分而采用的。

3. 对于`mov`指令，是这样的：源操作数指定的值是一个立即数，存储在寄存器中或者内存中。目的操作数指定一个位置，要么是一个寄存器要么是一个内存地址。`x86-64`加了一条限制：**传送指令的两个操作数不能都是指向内存位置。将一个值从一个内存位置拷贝到另一个内存位置，需要两条指令——第一条指令是将源值加载到寄存器中，第二条是将该寄存器值写入目的位置。**
4. 大多数情况下，`mov`指令只会更新目的操作数指定的那些寄存器字节或内存位置。唯一例外的是：**`movq`指令以寄存器为目的的时候，它会把该寄存器的高4位设置为0**。造成这个例外的原因是因为`x86-64`采用的惯例，也就是上述`2`所描述的。
5. 对于`movabsq I,R`指令，是这样的：这条指令是用来处理64位立即数数据的，常规的`movq`指令只能以表示为32位补码数字的立即数作为源操作数,然后把这个值符号扩展得到64位的值,放到目的位置。`movabsq`指令能够以**任意64位立即数值作为源操作数,并且只能以寄存器作为目的**。
6. ```assembly
   // 4、5的例子
   movabsq $0x0011223344556677, %rax		%rax = 0011223344556677
   movb 	$-1, %al						%rax = 00112233445566FF
   movw 	$-1, %ax						%rax = 001122334455FFFF
   movl 	$-1, %eax						%rax = 00112233FFFFFFFF
   movq 	$-1, %rax						%rax = FFFFFFFFFFFFFFFF
   ```

   

## GDB

1. 查看当前汇编: `disas`
2. 当前汇编下前进几行: `ni + 行数`
3. 进入当前指令：`si`
4. 查看寄存器：`info r`
5. 查看内存: https://blog.csdn.net/xiaozhiwise/article/details/122732433?

### 杂绪
1. 规约
1. 大端（存储）模式，是指数据的低位保存在内存的高地址中，而数据的高位保存在内存的低地址中;
3. 小端（存储）模式，是指数据的低位保存在内存的低地址中，而数据的高位保存在内存的高地址中;
   - 例如：`Intel x86`系列的CPU。